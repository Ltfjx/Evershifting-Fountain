---
title: "Yoiyami-v3 服务器搬家记录"
date: 2024-11-02 16:02:00
index_img: /potato-resources/blog_pic/24110201/cover.webp
banner_img: /potato-resources/blog_pic/24110201/banner.webp
categories: "共振"
tags:
 - 服务器
 - 网站
 - 运维
 - ESXi
 - 虚拟化
 - frp
excerpt: "又是一年一度的服务器搬迁，但这次我选择了将 Yoiyami 从云服务器搬到物理服务器上。"
---

# 缘起
Yoiyami-v2 的服务器很快就要过期了，位于阿里云的新加坡机房。在前 12 个月的使用周期里，我对这个服务器有着这些不满意的地方：

 - **网络线路**
 这个服务器的网络线路比较差，国内访问速度和质量并不理想，导致虽然有高带宽但根本跑不到很高的速度。

 - **配置**
 CPU 性能还算够用，但 2G 的内存和 60G 硬盘实在是用起来有些吃力。

 - **最后也是对我而言最不能忍受的：价格**
 很多服务器商都以首年低价续费高价的方式进行营销，阿里云也不例外。所以我不得不每年更换服务商来降低服务器运营成本，实在是太麻烦了。

为了一劳永逸地解决这些问题，我决定自己搭建一个低功耗、高性价比、可拓展性强、稳定的物理服务器。

# 方案

## 硬件

对于家用服务器来说，低功耗、低噪音和小尺寸是很重要的，所以我最终选择了 `HP800G1DM` 作为服务器的准系统。

![](./potato-resources/blog_pic/24110201/10.webp)

接下来是 CPU，我选择了 4 核心，TDP 为 35W 的 `i5-4590T`，作为以提供 web 服务为主的服务器来说性能完全足够，且足够节能。

内存方面，我选择了 `8+8G` 的配置，比之前的服务器有了很大的提升。

![](./potato-resources/blog_pic/24110201/11.webp)

由于短期内没有对大容量存储的需求，我暂时只选择了一块 `120G` 的 SSD 作为系统盘。

## 软件

由于除了用于提供各种 web 服务的 linux 系统之外，我还希望能有一个 Windows 系统运行一些脚本等，所以我选择了 `VMware ESXi` 作为服务器系统。

`VMware ESXi` 是一个强大且灵活的虚拟化解决方案，可以轻松管理多个虚拟机，这也就意味着所有操作系统都将会运行在虚拟化环境中。通俗来讲就是把一台物理服务器分成好几台虚拟服务器。

经过资料查阅，ESXi 并不会对性能造成特别大的损失，但却可以换来更灵活的部署方式和可拓展性，对于我这样的需求来说非常合适。

关于网络方面，由于家用网络没有固定的公网 IP，所以我会选择 `frp` 作为公网通信方式。

## 成本
 - HP800G1DM + 电源 200r
 - i5-4590T 100r
 - 内存 8G*2 50r
 - SSD 120G 30r

以上为设备购置费用，下面是固定支出：

 - frp 服务 10r/月
 - 电费

# 上手

## 硬件测试

机器到手，先拆机安装硬件。

![](./potato-resources/blog_pic/24110201/1.webp)
![](./potato-resources/blog_pic/24110201/2.webp)

进 Windows 测试一下基本功能。

![](./potato-resources/blog_pic/24110201/3.webp)

## 系统安装

硬件测试完毕后，接下来就是安装 ESXi 系统。安装的过称比较简单，直接根据提示一步步走即可。

唯一需要注意的是，ESXi 默认会把硬盘所有空间分配给 ESXi 系统，但实际上根本不用这么大，完全可以把剩下的空间留给虚拟机，调整方式如下：

> 第一次启动安装时，按 shift+o
> 在 cdromBoot runweasel 后输入 autoPartitionOSDataSize=8192，区分大小写，单位为 MB

![](./potato-resources/blog_pic/24110201/4.webp)
![](./potato-resources/blog_pic/24110201/5.webp)

安装完毕，接下来插入网线，重启进入系统。

![](./potato-resources/blog_pic/24110201/7.webp)

等待系统启动完毕后就可以在局域网环境下通过服务器的 IP 访问到 ESXi 的 web 界面了。

![](./potato-resources/blog_pic/24110201/6.webp)

## 配置虚拟机

有了 web 界面之后，剩余的步骤就很简单了，根据自己的需求分配资源，安装各种虚拟机即可。

![](./potato-resources/blog_pic/24110201/8.webp)

配置虚拟机自动启动。

![](./potato-resources/blog_pic/24110201/9.webp)

关于内网网络方面，每一台虚拟机都是能够独享一个 IP 的，所以不需要额外配置，非常方便。

最后配置好 frp，进行服务的迁移，把网站的域名和 DNS 解析指向新的 frp 服务器即可。

![](./potato-resources/blog_pic/24110201/12.webp)

大功告成！

# 后记
Yoiyami 服务器的搬迁至此就告一段落了，这次体验了一下 ESXi 虚拟化技术的便利，也算是一次不错的实践。

在半个月的使用时间里，服务器运行非常稳定，使用体验很棒。后续可能还会再给服务器加几块 HDD，用于资源存储，不过那就是后话了。

总而言之，我很推荐使用物理服务器来替代云服务器，虽然成本节省的可能不算很多，但能带来比云服务器好得多的可拓展性。如果你也有这样的想法的话，不妨去试试吧。

![似乎有些过剩的 CPU 性能 :P](./potato-resources/blog_pic/24110201/13.webp)